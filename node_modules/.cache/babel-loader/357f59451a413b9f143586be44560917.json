{"ast":null,"code":"import Janus from'./janus/janus';var server=null;var janus=null;var screenHandle=null;var videoHandlerOnPC=null;var myId=null;var room=1234;var opaqueId='박시연';// 무슨 역할?\nvar TEST_CANDIDATE_NUM=5;if(window.location.protocol==='http:')server='http://'+'re-coder.net'+'/janus';else server='https://'+'re-coder.net'+'/janus';export function runJanusMobile(studentId){Janus.init({debug:'all',callback:function callback(){janus=new Janus({server:server,opaqueId:opaqueId,success:function success(){// VideoRoom plugin 지정\njanus.attach({plugin:'janus.plugin.videoroom',opaqueId:opaqueId,success:function success(pluginHandle){videoHandlerOnPC=pluginHandle;myId=Number(studentId)+2;Janus.log(\"Plugin attached! (\".concat(videoHandlerOnPC.getPlugin(),\"\\n                                    , ID = \").concat(videoHandlerOnPC.getId(),\")\"));// room = createTheRoom(TEST_CANDIDATE_NUM);\njoinTheRoom(1234,myId);},// WebRTC 권한 허용 표시 관련 UI 출력\n// User 등록 후 실행 콜백\n// msg 값에 따라 event 처리 가능\nonmessage:function onmessage(msg,jsep){Janus.debug(' ::: Got a message (publisher) :::',msg);var event=msg['videoroom'];Janus.debug('Event: '+event);if(event){if(event==='joined'){myId=msg['id'];Janus.log(\"\".concat(msg['room'],\"\\uC5D0 \\uC131\\uACF5\\uC801\\uC73C\\uB85C \\uC811\\uC18D\\uD558\\uC600\\uC2B5\\uB2C8\\uB2E4. ID = \").concat(myId));publishOwnFeed(msg);}}if(jsep){Janus.debug('Handling SDP as well...',jsep);videoHandlerOnPC.handleRemoteJsep({jsep:jsep});}},// localStreamData를 받아온다\nonlocalstream:function onlocalstream(stream){Janus.debug(' ::: Got a local stream :::',stream);Janus.log('onlocalstream 실행');// html tag 값 가져오기\nvar myVideo=document.getElementById('myvideo');// tag에 stream data 붙이기\nJanus.attachMediaStream(myVideo,stream);},oncleanup:function oncleanup(){}});},error:function error(_error){Janus.error(_error);},destroyed:function destroyed(){window.location.reload();}});}});};/**\n * @description 방 접속\n * @param {접속할 방 번호} roomID\n */function joinTheRoom(roomID,userId){var register={request:'join',room:roomID,ptype:'publisher',display:\"\"+userId};videoHandlerOnPC.send({message:register,success:function success(){Janus.log('방에 접속하였습니다 !');return true;},error:function error(_error2){Janus.error('WebRTC error:',_error2);Janus.log('방에 접속하지 못했습니다 !');return false;}});}/**\n * @description 방 생성\n * @param {시험의 총 참가자 수} numOfCandidate\n */function createTheRoom(numOfCandidate){var create={request:'create',bitrate:500000,// 참여 가능한 publisher 수 = (참가자 인원 * 3) + (eyetracker, promoter)\npublishers:numOfCandidate*3+2};videoHandlerOnPC.send({message:create,success:function success(result){Janus.log(\"room = \".concat(result['room'],\" \\uBC29\\uC774 \\uC0DD\\uC131\\uB418\\uC5C8\\uC2B5\\uB2C8\\uB2E4.\"));// 방 번호 return\njoinTheRoom(result['room']);},error:function error(_error3){Janus.error('WebRTC error:',_error3);Janus.log('방이 생성되지 않았습니다 !');return false;}});return null;}/**\n * @description 방 존재 여부 체크\n * @param {시험 방 번호} roomNum\n */function isRoomExist(roomNum){var exists={request:'exists',room:roomNum};videoHandlerOnPC.send({message:exists,success:function success(){Janus.log(\"roomID = \".concat(roomNum,\" \\uBC29\\uC774 \\uC874\\uC7AC\\uD569\\uB2C8\\uB2E4.\"));return true;},error:function error(_error4){Janus.error('WebRTC error:',_error4);Janus.log(\"roomID = \".concat(roomNum,\" \\uBC29\\uC774 \\uC874\\uC7AC\\uD558\\uC9C0 \\uC54A\\uC2B5\\uB2C8\\uB2E4.\"));return false;}});}/**\n * @description createOffer 를 통해서 webCamFeed 생성\n */function publishOwnFeed(msg){videoHandlerOnPC.createOffer({media:{audioRecv:false,videoRecv:false,audioSend:false,videoSend:true},success:function success(jsep){Janus.log('Got publisher SDP!',jsep);var publish={request:'configure',audio:false,video:true};videoHandlerOnPC.send({message:publish,jsep:jsep});// localScreenFeed 생성\n// Janus.log(msg['publishers']['id']);\n// localScreenFeed(msg);\n},error:function error(_error5){Janus.error('WebRTC error:',_error5);publishOwnFeed(msg);}});}","map":{"version":3,"sources":["/Users/kanbaer/capstone-project-re-coder/src/module/examCandidateMobile.js"],"names":["Janus","server","janus","screenHandle","videoHandlerOnPC","myId","room","opaqueId","TEST_CANDIDATE_NUM","window","location","protocol","runJanusMobile","studentId","init","debug","callback","success","attach","plugin","pluginHandle","Number","log","getPlugin","getId","joinTheRoom","onmessage","msg","jsep","event","publishOwnFeed","handleRemoteJsep","onlocalstream","stream","myVideo","document","getElementById","attachMediaStream","oncleanup","error","destroyed","reload","roomID","userId","register","request","ptype","display","send","message","createTheRoom","numOfCandidate","create","bitrate","publishers","result","isRoomExist","roomNum","exists","createOffer","media","audioRecv","videoRecv","audioSend","videoSend","publish","audio","video"],"mappings":"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","sourcesContent":["import Janus from './janus/janus';\n\nlet server = null;\nlet janus = null;\n\nlet screenHandle = null;\nlet videoHandlerOnPC = null;\n\nlet myId = null;\nlet room = 1234;\n\nlet opaqueId = '박시연'; // 무슨 역할?\nconst TEST_CANDIDATE_NUM = 5;\n\nif (window.location.protocol === 'http:')\n\tserver = 'http://' + 're-coder.net' + '/janus';\nelse server = 'https://' + 're-coder.net' + '/janus';\n\nexport function runJanusMobile(studentId) {\n\tJanus.init({\n\t\tdebug: 'all',\n\t\tcallback: function () {\n\t\t\tjanus = new Janus({\n\t\t\t\tserver: server,\n\t\t\t\topaqueId: opaqueId,\n\t\t\t\tsuccess: function () {\n\t\t\t\t\t// VideoRoom plugin 지정\n\t\t\t\t\tjanus.attach({\n\t\t\t\t\t\tplugin: 'janus.plugin.videoroom',\n\t\t\t\t\t\topaqueId: opaqueId,\n\n\t\t\t\t\t\tsuccess: function (pluginHandle) {\n\t\t\t\t\t\t\tvideoHandlerOnPC = pluginHandle;\n\t\t\t\t\t\t\tmyId = Number(studentId) + 2;\n\n\t\t\t\t\t\t\tJanus.log(\n\t\t\t\t\t\t\t\t`Plugin attached! (${videoHandlerOnPC.getPlugin()}\n                                    , ID = ${videoHandlerOnPC.getId()})`\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t// room = createTheRoom(TEST_CANDIDATE_NUM);\n\t\t\t\t\t\t\tjoinTheRoom(1234, myId);\n\t\t\t\t\t\t},\n\t\t\t\t\t\t// WebRTC 권한 허용 표시 관련 UI 출력\n\t\t\t\t\t\t// User 등록 후 실행 콜백\n\t\t\t\t\t\t// msg 값에 따라 event 처리 가능\n\t\t\t\t\t\tonmessage: function (msg, jsep) {\n\t\t\t\t\t\t\tJanus.debug(\n\t\t\t\t\t\t\t\t' ::: Got a message (publisher) :::',\n\t\t\t\t\t\t\t\tmsg\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\tlet event = msg['videoroom'];\n\t\t\t\t\t\t\tJanus.debug('Event: ' + event);\n\n\t\t\t\t\t\t\tif (event) {\n\t\t\t\t\t\t\t\tif (event === 'joined') {\n\t\t\t\t\t\t\t\t\tmyId = msg['id'];\n\n\t\t\t\t\t\t\t\t\tJanus.log(\n\t\t\t\t\t\t\t\t\t\t`${msg['room']}에 성공적으로 접속하였습니다. ID = ${myId}`\n\t\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\t\tpublishOwnFeed(msg);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tif (jsep) {\n\t\t\t\t\t\t\t\tJanus.debug('Handling SDP as well...', jsep);\n\t\t\t\t\t\t\t\tvideoHandlerOnPC.handleRemoteJsep({\n\t\t\t\t\t\t\t\t\tjsep: jsep,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\t// localStreamData를 받아온다\n\t\t\t\t\t\tonlocalstream: function (stream) {\n\t\t\t\t\t\t\tJanus.debug(' ::: Got a local stream :::', stream);\n\t\t\t\t\t\t\tJanus.log('onlocalstream 실행');\n\n\t\t\t\t\t\t\t// html tag 값 가져오기\n\t\t\t\t\t\t\tlet myVideo = document.getElementById('myvideo');\n\t\t\t\t\t\t\t// tag에 stream data 붙이기\n\t\t\t\t\t\t\tJanus.attachMediaStream(myVideo, stream);\n\t\t\t\t\t\t},\n\t\t\t\t\t\toncleanup: function () {},\n\t\t\t\t\t});\n\t\t\t\t},\n\t\t\t\terror: function (error) {\n\t\t\t\t\tJanus.error(error);\n\t\t\t\t},\n\t\t\t\tdestroyed: function () {\n\t\t\t\t\twindow.location.reload();\n\t\t\t\t},\n\t\t\t});\n\t\t},\n\t});\n};\n\n/**\n * @description 방 접속\n * @param {접속할 방 번호} roomID\n */\nfunction joinTheRoom(roomID, userId) {\n\tlet register = {\n\t\trequest: 'join',\n\t\troom: roomID,\n\t\tptype: 'publisher',\n\t\tdisplay: \"\" + userId,\n\t};\n\n\tvideoHandlerOnPC.send({\n\t\tmessage: register,\n\t\tsuccess: function () {\n\t\t\tJanus.log('방에 접속하였습니다 !');\n\t\t\treturn true;\n\t\t},\n\t\terror: function (error) {\n\t\t\tJanus.error('WebRTC error:', error);\n\t\t\tJanus.log('방에 접속하지 못했습니다 !');\n\t\t\treturn false;\n\t\t},\n\t});\n}\n\n/**\n * @description 방 생성\n * @param {시험의 총 참가자 수} numOfCandidate\n */\nfunction createTheRoom(numOfCandidate) {\n\tlet create = {\n\t\trequest: 'create',\n\t\tbitrate: 500000,\n\t\t// 참여 가능한 publisher 수 = (참가자 인원 * 3) + (eyetracker, promoter)\n\t\tpublishers: numOfCandidate * 3 + 2,\n\t};\n\n\tvideoHandlerOnPC.send({\n\t\tmessage: create,\n\t\tsuccess: function (result) {\n\t\t\tJanus.log(`room = ${result['room']} 방이 생성되었습니다.`);\n\t\t\t// 방 번호 return\n\t\t\tjoinTheRoom(result['room']);\n\t\t},\n\t\terror: function (error) {\n\t\t\tJanus.error('WebRTC error:', error);\n\t\t\tJanus.log('방이 생성되지 않았습니다 !');\n\t\t\treturn false;\n\t\t},\n\t});\n\n\treturn null;\n}\n\n/**\n * @description 방 존재 여부 체크\n * @param {시험 방 번호} roomNum\n */\nfunction isRoomExist(roomNum) {\n\tlet exists = {\n\t\trequest: 'exists',\n\t\troom: roomNum,\n\t};\n\n\tvideoHandlerOnPC.send({\n\t\tmessage: exists,\n\t\tsuccess: function () {\n\t\t\tJanus.log(`roomID = ${roomNum} 방이 존재합니다.`);\n\t\t\treturn true;\n\t\t},\n\t\terror: function (error) {\n\t\t\tJanus.error('WebRTC error:', error);\n\t\t\tJanus.log(`roomID = ${roomNum} 방이 존재하지 않습니다.`);\n\t\t\treturn false;\n\t\t},\n\t});\n}\n\n/**\n * @description createOffer 를 통해서 webCamFeed 생성\n */\nfunction publishOwnFeed(msg) {\n\tvideoHandlerOnPC.createOffer({\n\t\tmedia: {\n\t\t\taudioRecv: false,\n\t\t\tvideoRecv: false,\n\t\t\taudioSend: false,\n\t\t\tvideoSend: true,\n\t\t},\n\t\tsuccess: function (jsep) {\n\t\t\tJanus.log('Got publisher SDP!', jsep);\n\t\t\tlet publish = { request: 'configure', audio: false, video: true };\n\t\t\tvideoHandlerOnPC.send({ message: publish, jsep: jsep });\n\n\t\t\t// localScreenFeed 생성\n\t\t\t// Janus.log(msg['publishers']['id']);\n\t\t\t// localScreenFeed(msg);\n\t\t},\n\t\terror: function (error) {\n\t\t\tJanus.error('WebRTC error:', error);\n\t\t\tpublishOwnFeed(msg);\n\t\t},\n\t});\n}\n"]},"metadata":{},"sourceType":"module"}